<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rabbit PipeFit Pro</title>
    <style>
        :root { --orange: #ff4e00; --bg: #000; --card: #111; --text: #fff; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; overflow: hidden; }
        
        .header { background: #000; border-bottom: 2px solid var(--orange); padding: 8px; text-align: center; font-weight: bold; font-size: 0.9rem;}
        .tabs { display: flex; height: 45px; background: #111; border-bottom: 1px solid #333; }
        .tab-btn { flex: 1; border: none; background: none; color: #666; font-size: 0.65rem; font-weight: bold; text-transform: uppercase; }
        .tab-btn.active { color: var(--orange); border-bottom: 2px solid var(--orange); }

        .content { height: calc(100vh - 95px); overflow-y: auto; padding: 12px; box-sizing: border-box; }
        
        .card { background: var(--card); border-radius: 12px; padding: 15px; border: 1px solid #333; margin-bottom: 15px; }
        .label { font-size: 0.7rem; color: #888; text-transform: uppercase; margin-bottom: 8px; display: block;}
        
        /* Inputs et Clavier */
        input { background: #222; border: 1px solid var(--orange); color: white; padding: 12px; width: 100%; border-radius: 8px; font-size: 1.2rem; box-sizing: border-box; margin-bottom: 10px; }
        .btn-calc { background: var(--orange); color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer; }
        
        .res-value { font-size: 2.5rem; color: var(--orange); font-weight: bold; text-align: center; margin: 10px 0; }
        .res-unit { font-size: 0.9rem; color: #ccc; text-align: center; }

        select { background: #222; color: white; padding: 10px; width: 100%; border-radius: 8px; border: 1px solid #444; margin-bottom: 10px; }

        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        th { color: var(--orange); text-align: left; padding: 8px; border-bottom: 1px solid #333; }
        td { padding: 8px; border-bottom: 1px solid #222; }
    </style>
</head>
<body>

    <div class="header">RABBIT PIPEFIT PRO v1.2</div>
    
    <div class="tabs">
        <button id="t-dev" class="tab-btn active" onclick="showTab('dev')">Dévoiement</button>
        <button id="t-coude" class="tab-btn" onclick="showTab('coude')">Coudes</button>
        <button id="t-aba" class="tab-btn" onclick="showTab('aba')">Abaques</button>
    </div>

    <div class="content">
        <div id="sec-dev">
            <div class="card">
                <span class="label">Plongée (mm)</span>
                <input type="number" id="inp-plongee" placeholder="Ex: 300">
                <button class="btn-calc" onclick="calcDev()">CALCULER (45°)</button>
                <div id="res-dev" class="res-value">---</div>
                <div class="res-unit">Longueur du tube (mm)</div>
            </div>
        </div>

        <div id="sec-coude" style="display:none;">
            <div class="card">
                <span class="label">Type de Coude</span>
                <select id="sel-type">
                    <option value="1.5">3D (Long Rayon - 1.5D)</option>
                    <option value="1">2D (Court Rayon)</option>
                    <option value="2.5">5D (Rayon 2.5D)</option>
                </select>
                <span class="label">Diamètre Nominal (DN)</span>
                <input type="number" id="inp-dn" placeholder="Ex: 80">
                <button class="btn-calc" onclick="calcCoude()">VOIR ENCOMBREMENT</button>
                <div id="res-coude" class="res-value">---</div>
                <div class="res-unit">Encombrement (mm)</div>
            </div>
            <p style="font-size:0.6rem; color:#666;">Note: Calcul basé sur l'axe du coude à 90°.</p>
        </div>

        <div id="sec-aba" style="display:none;">
            <div class="card">
                <table>
                    <thead>
                        <tr><th>DN</th><th>Ext. mm</th><th>Série</th></tr>
                    </thead>
                    <tbody id="abaque-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const tubeData = [
            {dn: "15", ext: "21.3", serie: "1/2\""},
            {dn: "20", ext: "26.9", serie: "3/4\""},
            {dn: "25", ext: "33.7", serie: "1\""},
            {dn: "40", ext: "48.3", serie: "1\"1/2"},
            {dn: "50", ext: "60.3", serie: "2\""},
            {dn: "80", ext: "88.9", serie: "3\""},
            {dn: "100", ext: "114.3", serie: "4\""},
            {dn: "150", ext: "168.3", serie: "6\""}
        ];

        function showTab(t) {
            document.getElementById('sec-dev').style.display = (t === 'dev') ? 'block' : 'none';
            document.getElementById('sec-coude').style.display = (t === 'coude') ? 'block' : 'none';
            document.getElementById('sec-aba').style.display = (t === 'aba') ? 'block' : 'none';
            
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('t-' + t).classList.add('active');
        }

        // Calcul Dévoiement 45°
        function calcDev() {
            const val = document.getElementById('inp-plongee').value;
            if(val) {
                const res = Math.round(val * 1.414);
                document.getElementById('res-dev').innerText = res;
                speak("Longueur du tube : " + res + " millimètres.");
            }
        }

        // Calcul Encombrement Coude
        function calcCoude() {
            const dn = document.getElementById('inp-dn').value;
            const rayon = document.getElementById('sel-type').value;
            if(dn) {
                // Formule standard : E = Rayon * DN (approximatif pour ISO)
                // Pour du 3D (1.5D) : E = 1.5 * DN
                const res = Math.round(dn * rayon);
                document.getElementById('res-coude').innerText = res;
                speak("Encombrement : " + res + " millimètres.");
            }
        }

        function speak(text) {
            if (typeof PluginMessageHandler !== 'undefined') {
                PluginMessageHandler.postMessage(JSON.stringify({message: text, useLLM: false}));
            }
        }

        window.onload = () => {
            const body = document.getElementById('abaque-body');
            body.innerHTML = tubeData.map(t => `
                <tr><td>DN ${t.dn}</td><td style="color:var(--orange)">${t.ext}</td><td>${t.serie}</td></tr>
            `).join('');
        };
    </script>
</body>
</html>
